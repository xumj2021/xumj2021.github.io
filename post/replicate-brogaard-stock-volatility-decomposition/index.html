<!DOCTYPE html>
<html lang="en-us">
<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-309KENXF47"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-309KENXF47');
    </script>

    
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css" integrity="sha384-Juol1FqnotbkyZUT5Z7gUPjQ9gzlwCENvUZTpQBAPxtusdwFLRy382PSDx5UUJ4/" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.js" integrity="sha384-97gW6UIJxnlKemYavrqDHSX3SiygeOwIZhwyOKRfSaf0JWKRVj9hLASHgFTzT+0O" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Democratize Data For Insights">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://assets.bbhub.io/image/v1/convert?type=auto&amp;url=https%3A%2F%2Fassets.bbhub.io%2Fprofessional%2Fsites%2F10%2F377643951.jpg">
    <meta property="twitter:image" content="https://assets.bbhub.io/image/v1/convert?type=auto&amp;url=https%3A%2F%2Fassets.bbhub.io%2Fprofessional%2Fsites%2F10%2F377643951.jpg" />
    

    
    <meta name="title" content="Replicate Brogaard Stock Volatility Decomposition" />
    <meta property="og:title" content="Replicate Brogaard Stock Volatility Decomposition" />
    <meta property="twitter:title" content="Replicate Brogaard Stock Volatility Decomposition" />
    

    
    <meta name="description" content="Produce the stock information content measures introduced by Brogaard et al. (2022, RFS)">
    <meta property="og:description" content="Produce the stock information content measures introduced by Brogaard et al. (2022, RFS)" />
    <meta property="twitter:description" content="Produce the stock information content measures introduced by Brogaard et al. (2022, RFS)" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Mengjie, Xu, Python, Stata, SAS, Econometrics, Accounting, Crawling">
    <link rel="shortcut icon" href="/img/favicon.png.ico">

    <title>Mengjie Xu | Democratize Data For Insights</title>

    <link rel="canonical" href="/post/replicate-brogaard-stock-volatility-decomposition/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Home</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                       
                    </li>
                    
                        
                        <li>
                            <a href="/categories/anecdotes/">anecdotes</a>
                        </li>
                        
                        <li>
                            <a href="/categories/crawler/">crawler</a>
                        </li>
                        
                        <li>
                            <a href="/categories/data/">data</a>
                        </li>
                        
                        <li>
                            <a href="/categories/theory/">theory</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/about//">ABOUT</a></li>
                    
		            <li>
                       
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('https://assets.bbhub.io/image/v1/convert?type=auto&url=https%3A%2F%2Fassets.bbhub.io%2Fprofessional%2Fsites%2F10%2F377643951.jpg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/information" title="Information">
                            Information
                        </a>
                        
                        <a class="tag" href="/tags/stock-volatility" title="Stock Volatility">
                            Stock Volatility
                        </a>
                        
                    </div>
                    <h1>Replicate Brogaard Stock Volatility Decomposition</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                Mengjie Xu
                             
                            on 
                            Tuesday, January 10, 2023
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h2 id="introduction">Introduction</h2>
<p>Having recognized the potential of the stock volatility decomposition method introduced by Brogaard et al. (2022, RFS) in <a href="https://mengjiexu.com/post/an-information-based-decomposition-of-stock-price/">my previous blog</a>, I will show how to implement this method to empower your own research in this blog.</p>
<p>For readers with time constraints, the codes for implementing this variance decomposition method can be approched via <a href="https://mengjiexu.com/post/replicate-brogaard-stock-volatility-decomposition/#pack-codes">this link</a>.</p>
<p>As replicating Brogaard et al. (2022, RFS) requires some manipulations on the VAR estimation outputs, I took some time to figure out the theory and estimation of the reduced-form VAR coefficients, Impulse response functions (IRFs), structural IRFS, orthogonalized IRFs, and variance decomposition and summarized what I&rsquo;ve got in a three-blog series about VAR.</p>
<p>In <a href="https://mengjiexu.com/post/touch-into-var/">the first blog</a>, I  show the basic logics of VAR model with the simplest 2-variable, 1-lag VAR model. In <a href="https://mengjiexu.com/post/common-practice-of-var-estimation-in-stata/">the second blog</a>, I show how to use <code>var</code> and <code>svar</code> commands to conveniently estimate the VAR model in Stata. In <a href="https://mengjiexu.com/post/manually-replicate-statas-practice-in-estimations-of-var-irfs-and-variance-decomposition/">the third blog</a>, I dig deeper, show the theoretical definitions and calculation formula of major outputs in VAR model, and manually calculate them in Stata to thoroughly uncover the black box of the  VAR estimation.</p>
<p>For this blog, I will only focus on the paper-specific ideas. Readers who need more background information about VAR estimation can find clues in my three-blog series about VAR.</p>
<h2 id="data-and-sample">Data and Sample</h2>
<p>The sample used by Brogaard et al. (2022, RFS) consists of all common stocks listed on the NYSE, AMEX, and NASDAQ spanning from 1960 to 2015. Estimation of the VAR model requires daily data on stock returns, market returns, and dollar-signed stock trading volumes.</p>
<p>The reduced-form VAR model below is estimated in stock-year level.
$$
\begin{aligned}
&amp;r_{m, t}=a_0^*+\sum_{l=1}^5 a_{1, l}^* r_{m, t-l}+\sum_{l=1}^5 a_{2, l}^* x_{t-l}+\sum_{l=1}^5 a_{3, l}^* r_{t-l}+e_{r_m, t} \\\
&amp;x_t=b_0^*+\sum_{l=1}^5 b_{1, l}^* r_{m, t-l}+\sum_{l=1}^5 b_{2, l}^* x_{t-l}+\sum_{l=1}^5 b_{3, l}^* r_{t-l}+e_{x, t} \\\
&amp;r_t=c_0^*+\sum_{l=1}^5 c_{1, l}^* r_{m, t-l}+\sum_{l=1}^5 c_{2, l}^* x_{t-l}+\sum_{l=1}^5 c_{3, l}^* r_{t-l}+e_{r, t}
\end{aligned} \tag{1}
$$
where</p>
<ul>
<li>\(r_{m,t}\) is the market return, the corresponding innovation \(\varepsilon_{r_{m,t}}\) represents innovations in market-wide information</li>
<li>\(x_t\) is the signed dollar volume of trading in the given stock, the corresponding innovation \(\varepsilon_{x,t}\) represents innovations in firm-specific private information</li>
<li>\(r_t\) is the stock return, the corresponding innovation \(\varepsilon_{r,t}\) represents innovations in firm-specific public information</li>
<li>the authors assume that \(\{\varepsilon_{r_m, t}, \varepsilon_{x, t}, \varepsilon_{r, t}\}\) are contemporaneously uncorrelated</li>
</ul>
<h2 id="download-data">Download Data</h2>
<p>To better serve my research purpose, in this blog I will implement the stock-year level variance decomposition for all common stocks listed on the NYSE, AMEX, and NASDAQ spanning from 2005 to 2021.</p>
<p>The SAS code for downloading the data is as follows. I first log in the WRDS server in SAS. Then I download the daily stock price, trading volume, return, and market return for all common stocks listed on the NYSE, AMEX, and NASDAQ - that&rsquo;s exactly what the CRSP got. For ease of importing into Stata, I transfer all the downloaded <code>sas</code> dataset into <code>csv</code> format. As the daily CRSP data is too huge, I implement all the above procedures year by year.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-28">28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-29">29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-30"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-30">30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-31"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-31">31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-32"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-32">32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-33"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-33">33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-34"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-34">34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-35"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-35">35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-36"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-36">36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-37"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-37">37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-38"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-38">38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-39"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-39">39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-40"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-40">40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-41"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-41">41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-42"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-42">42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-43"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-43">43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-44"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-44">44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-45"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-45">45</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#111">libname</span> <span style="color:#111">home</span> <span style="color:#d88200">&#34;C:\Users\xu-m\Documents</span><span style="color:#8045ff">\t</span><span style="color:#d88200">estVAR</span><span style="color:#8045ff">\r</span><span style="color:#d88200">awdata2005-2021sas&#34;</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/*</span> <span style="color:#111">log</span> <span style="color:#f92672">in</span> <span style="color:#111">WRDS</span> <span style="color:#111">server</span> <span style="color:#f92672">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">let</span> <span style="color:#111">wrds</span> <span style="color:#f92672">=</span> <span style="color:#111">wrds</span><span style="color:#f92672">.</span><span style="color:#111">wharton</span><span style="color:#f92672">.</span><span style="color:#111">upenn</span><span style="color:#f92672">.</span><span style="color:#111">edu</span> <span style="color:#ae81ff">4016</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">options</span> <span style="color:#111">comamid</span><span style="color:#f92672">=</span><span style="color:#111">TCP</span> <span style="color:#111">remote</span><span style="color:#f92672">=</span><span style="color:#111">WRDS</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">signon</span> <span style="color:#111">username</span><span style="color:#f92672">=</span><span style="color:#111">xxx</span> <span style="color:#111">pwd</span><span style="color:#f92672">=</span><span style="color:#111">xxx</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">run</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">signoff</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/*</span> <span style="color:#111">download</span> <span style="color:#111">daily</span> <span style="color:#111">stock</span> <span style="color:#111">price</span><span style="color:#111">,</span> <span style="color:#111">trading</span> <span style="color:#111">volume</span><span style="color:#111">,</span> <span style="color:#00a8c8">return</span><span style="color:#111">,</span> <span style="color:#f92672">and</span> <span style="color:#111">market</span> <span style="color:#00a8c8">return</span> <span style="color:#111">from</span> <span style="color:#111">CRSP</span><span style="color:#f92672">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rsubmit</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">macro</span> <span style="color:#111">downyear</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#f92672">%</span><span style="color:#00a8c8">do</span> <span style="color:#111">year</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2005</span> <span style="color:#f92672">%</span><span style="color:#111">to</span> <span style="color:#ae81ff">2021</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>	 	<span style="color:#f92672">%</span><span style="color:#111">let</span> <span style="color:#111">firstdate</span> <span style="color:#f92672">=</span> <span style="color:#f92672">%</span><span style="color:#111">sysfunc</span><span style="color:#111">(</span><span style="color:#111">mdy</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">%</span><span style="color:#111">let</span> <span style="color:#111">lastdate</span> <span style="color:#f92672">=</span> <span style="color:#f92672">%</span><span style="color:#111">sysfunc</span><span style="color:#111">(</span><span style="color:#111">mdy</span><span style="color:#111">(</span><span style="color:#ae81ff">12</span><span style="color:#111">,</span><span style="color:#ae81ff">31</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">%</span><span style="color:#111">put</span> <span style="color:#f92672">&amp;</span><span style="color:#111">year</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">proc</span> <span style="color:#111">sql</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">create</span> <span style="color:#111">table</span> <span style="color:#111">sampleforvar</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span> <span style="color:#111">as</span> <span style="color:#111">select</span> <span style="color:#111">distinct</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#111">cusip</span><span style="color:#111">,</span> <span style="color:#111">date</span><span style="color:#111">,</span> <span style="color:#111">ret</span><span style="color:#111">,</span> <span style="color:#111">prc</span><span style="color:#111">,</span> <span style="color:#111">vol</span><span style="color:#111">,</span> <span style="color:#111">numtrd</span><span style="color:#111">,</span> <span style="color:#111">shrout</span><span style="color:#111">,</span> <span style="color:#111">hsiccd</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">from</span> <span style="color:#111">crsp</span><span style="color:#f92672">.</span><span style="color:#111">dsf</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">where</span> <span style="color:#111">date</span> <span style="color:#111">ge</span> <span style="color:#f92672">&amp;</span><span style="color:#111">firstdate</span> <span style="color:#f92672">and</span> <span style="color:#111">date</span> <span style="color:#111">le</span> <span style="color:#f92672">&amp;</span><span style="color:#111">lastdate</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">quit</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">proc</span> <span style="color:#111">sql</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">create</span> <span style="color:#111">table</span> <span style="color:#111">sampleforvar</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span> <span style="color:#111">as</span> <span style="color:#111">select</span> <span style="color:#111">a</span><span style="color:#f92672">.*</span><span style="color:#111">,</span> <span style="color:#111">b</span><span style="color:#f92672">.*</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">from</span> <span style="color:#111">sampleforvar</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span> <span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#111">crsp</span><span style="color:#f92672">.</span><span style="color:#111">dsi</span> <span style="color:#111">b</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">where</span> <span style="color:#111">a</span><span style="color:#f92672">.</span><span style="color:#111">date</span><span style="color:#f92672">=</span><span style="color:#111">b</span><span style="color:#f92672">.</span><span style="color:#111">date</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">quit</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">proc</span> <span style="color:#111">download</span> <span style="color:#111">data</span><span style="color:#f92672">=</span><span style="color:#111">sampleforvar</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span> <span style="color:#111">out</span><span style="color:#f92672">=</span><span style="color:#111">home</span><span style="color:#f92672">.</span><span style="color:#111">sampleforvar</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span><span style="color:#111">;</span> <span style="color:#111">run</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">%</span><span style="color:#111">end</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">mend</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">downyear</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">endrsubmit</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">/*</span> <span style="color:#111">transfer</span> <span style="color:#111">the</span> <span style="color:#111">downloaded</span> <span style="color:#111">sas</span> <span style="color:#111">dataset</span> <span style="color:#111">into</span> <span style="color:#111">csv</span> <span style="color:#111">format</span> <span style="color:#f92672">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">macro</span> <span style="color:#111">expyear</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#f92672">%</span><span style="color:#00a8c8">do</span> <span style="color:#111">year</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2005</span> <span style="color:#f92672">%</span><span style="color:#111">to</span> <span style="color:#ae81ff">2021</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>	 	<span style="color:#f92672">%</span><span style="color:#111">let</span> <span style="color:#111">outfile</span> <span style="color:#f92672">=</span> <span style="color:#f92672">%</span><span style="color:#111">sysfunc</span><span style="color:#111">(</span><span style="color:#111">cat</span><span style="color:#111">(</span><span style="color:#111">C</span><span style="color:#111">:</span>\<span style="color:#111">Users</span>\<span style="color:#111">xu</span><span style="color:#f92672">-</span><span style="color:#111">m</span>\<span style="color:#111">Documents</span>\<span style="color:#111">testVAR</span>\<span style="color:#111">rawdata2005</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2021</span><span style="color:#111">sas</span>\<span style="color:#111">sampleforvar</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">year</span><span style="color:#111">,</span> <span style="color:#f92672">.</span><span style="color:#111">csv</span><span style="color:#111">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">%</span><span style="color:#111">let</span> <span style="color:#111">outfile</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;</span><span style="color:#d88200">%s</span><span style="color:#d88200">ysfunc(tranwrd(&amp;outfile,</span><span style="color:#d88200">%s</span><span style="color:#d88200">tr( ),</span><span style="color:#d88200">%s</span><span style="color:#d88200">tr(%&#34;</span> <span style="color:#f92672">%</span><span style="color:#d88200">&#34;)))&#34;</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">proc</span> <span style="color:#00a8c8">export</span> <span style="color:#111">data</span><span style="color:#f92672">=</span><span style="color:#111">home</span><span style="color:#f92672">.</span><span style="color:#111">sampleforvar</span><span style="color:#f92672">&amp;</span><span style="color:#111">year</span> <span style="color:#111">outfile</span><span style="color:#f92672">=&amp;</span><span style="color:#111">outfile</span> <span style="color:#111">dbms</span><span style="color:#f92672">=</span><span style="color:#111">csv</span> <span style="color:#111">replace</span><span style="color:#111">;</span> <span style="color:#111">run</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">end</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">mend</span><span style="color:#111">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">expyear</span><span style="color:#111">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The output of this step is as follows. The raw data for each year is stored in <code>csv</code> file named as <code>sampleforvar</code> + <code>year</code>.</p>
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/bsample.png" width=800 height=400>
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">Figure 1: Sample List</div>
</center>
<h2 id="clean-data">Clean Data</h2>
<p>We have two tasks in this step.</p>
<ol>
<li>generate the 3 variables <code>rm</code>, <code>x</code>, and <code>r</code> for VAR estimation</li>
<li>set time series, which is the prerequisite for using the <code>svar</code> command</li>
</ol>
<p>Following Brogaard et al. (2022, RFS), the 3 variables for VAR estimation is constructed as follows.</p>
<ol>
<li>I use Equal-Weighted Return (<code>ewretd</code> in CRSP) in basis points as market return <code>rm</code></li>
<li>I use the daily Holding Period Return (<code>ret</code> in CRSP) in basis points as stock return <code>r</code></li>
<li>I use the daily signed dollar volume in $ thousands as stock order flow <code>x</code>
<ul>
<li>The daily signed dollar volume is defined as the product of daily stock price (<code>prc</code> in CRSP), trading volume (<code>vol</code> in CRSP), and the sign of the stocks&rsquo; daily return</li>
</ul>
</li>
</ol>
<p>To mitigate the impacts of outliers, I winsorized all the above variables at the 5% and 95% levels.</p>
<p>I set the index of trading days within a given stock-year to tag the time series.</p>
<p>The Stata codes are as follows. Note that I use the <code>cusip</code> and <code>year</code> as identifiers. For the convenience of looping over stocks, I generate a unique number <code>cusipcode</code> for each stock.</p>
<p>The output in this step is the yearly dataset named as <code>sampledata</code> +<code>year</code> that is ready for the implementation of the VAR estimation in stock-year level.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-28">28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-29">29</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">import</span> <span style="color:#111">data</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cd</span> <span style="color:#111">C</span><span style="color:#111">:</span>\<span style="color:#111">Users</span>\<span style="color:#111">xu</span><span style="color:#f92672">-</span><span style="color:#111">m</span>\<span style="color:#111">Documents</span>\<span style="color:#111">testVAR</span>\<span style="color:#111">rawdata2005</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2021</span><span style="color:#111">sas</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">cap</span> <span style="color:#111">program</span> <span style="color:#111">drop</span> <span style="color:#111">cleanforbrogaard</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cap</span> <span style="color:#111">program</span> <span style="color:#111">define</span> <span style="color:#111">cleanforbrogaard</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">import</span> <span style="color:#111">delimited</span> <span style="color:#d88200">&#34;sampleforvar`1&#39;.csv&#34;</span><span style="color:#111">,</span><span style="color:#111">clear</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">destring</span> <span style="color:#111">ret</span><span style="color:#111">,</span> <span style="color:#111">force</span> <span style="color:#111">replace</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">drop</span> <span style="color:#00a8c8">if</span> <span style="color:#111">ret</span><span style="color:#f92672">==.|</span><span style="color:#111">prc</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span><span style="color:#f92672">|</span><span style="color:#111">vol</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">g</span> <span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">ret</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">g</span> <span style="color:#111">prcsign</span> <span style="color:#f92672">=</span> <span style="color:#111">cond</span><span style="color:#111">(</span><span style="color:#111">ret</span><span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">g</span> <span style="color:#111">x</span><span style="color:#f92672">=</span><span style="color:#111">vol</span><span style="color:#f92672">*</span><span style="color:#111">prc</span><span style="color:#f92672">*</span><span style="color:#111">prcsign</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">g</span> <span style="color:#111">rm</span> <span style="color:#f92672">=</span> <span style="color:#111">ewretd</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#111">winsor2</span> <span style="color:#111">rm</span> <span style="color:#111">x</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">cuts</span><span style="color:#111">(</span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">95</span><span style="color:#111">)</span> <span style="color:#111">replace</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#111">encode</span> <span style="color:#111">cusip</span><span style="color:#111">,</span> <span style="color:#111">g</span><span style="color:#111">(</span><span style="color:#111">cusipcode</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">sort</span> <span style="color:#111">cusipcode</span> <span style="color:#111">date</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">by</span> <span style="color:#111">cusipcode</span><span style="color:#111">:</span> <span style="color:#111">g</span> <span style="color:#111">index</span><span style="color:#f92672">=</span><span style="color:#111">_n</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">xtset</span> <span style="color:#111">cusipcode</span> <span style="color:#111">index</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#111">g</span> <span style="color:#111">year</span> <span style="color:#f92672">=</span> <span style="color:#111">floor</span><span style="color:#111">(</span><span style="color:#111">date</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10000</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#111">keep</span> <span style="color:#111">cusip</span> <span style="color:#111">cusipcode</span> <span style="color:#111">year</span> <span style="color:#111">index</span> <span style="color:#111">rm</span> <span style="color:#111">x</span> <span style="color:#111">r</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">save</span> <span style="color:#111">sampledata</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">1</span><span style="color:#d88200">&#39;,replace</span>
</span></span><span style="display:flex;"><span><span style="color:#111">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">forvalues</span> <span style="color:#111">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2005</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2021</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">cleanforbrogaard</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">j</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="extract-estimation-unit-and-set-global-variables">Extract Estimation Unit and Set Global Variables</h2>
<p>As the VAR estimation is implemented in stock-year level, we need firstly extract the sample for each stock and year with the identifiers <code>cusip</code> and <code>year</code>. All the subsequent manipulations are functioning in the single stock-year dataset as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-28">28</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      +----------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>     |    cusip         r           x          rm   cusipc~e   index   year |
</span></span><span style="display:flex;"><span>     |----------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>  1. | 00032Q10    266.24    637.6158        54.7          1       1   2020 |
</span></span><span style="display:flex;"><span>  2. | 00032Q10     -1.56   -121.6986      -30.57          1       2   2020 |
</span></span><span style="display:flex;"><span>  3. | 00032Q10    123.44    190.1839       45.48          1       3   2020 |
</span></span><span style="display:flex;"><span>  4. | 00032Q10    233.06    243.7433        -.41          1       4   2020 |
</span></span><span style="display:flex;"><span>  5. | 00032Q10   -599.08    -1396.12    9.139999          1       5   2020 |
</span></span><span style="display:flex;"><span>     |----------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>  6. | 00032Q10    251.22    234.7973       29.41          1       6   2020 |
</span></span><span style="display:flex;"><span>  7. | 00032Q10   -245.06   -288.1359      -12.47          1       7   2020 |
</span></span><span style="display:flex;"><span>  8. | 00032Q10   -178.28   -149.2384       46.14          1       8   2020 |
</span></span><span style="display:flex;"><span>  9. | 00032Q10     -16.5    -76.8955        29.2          1       9   2020 |
</span></span><span style="display:flex;"><span> 10. | 00032Q10    201.65    135.6328       31.06          1      10   2020 |
</span></span><span style="display:flex;"><span>     |----------------------------------------------------------------------|
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span>     |----------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>246. | 00032Q10       400    4548.106      -18.55          1     246   2020 |
</span></span><span style="display:flex;"><span>247. | 00032Q10    -96.15   -1940.581       38.66          1     247   2020 |
</span></span><span style="display:flex;"><span>248. | 00032Q10    291.26    4240.543      108.42          1     248   2020 |
</span></span><span style="display:flex;"><span>249. | 00032Q10    -94.34   -937.4673       -2.77          1     249   2020 |
</span></span><span style="display:flex;"><span>250. | 00032Q10   -285.71   -2000.298        13.5          1     250   2020 |
</span></span><span style="display:flex;"><span>     |----------------------------------------------------------------------|
</span></span><span style="display:flex;"><span>251. | 00032Q10   -588.24   -2000.485      -84.83          1     251   2020 |
</span></span><span style="display:flex;"><span>252. | 00032Q10     312.5    1369.296      101.55          1     252   2020 |
</span></span><span style="display:flex;"><span>253. | 00032Q10   -101.01    -862.252      -10.58          1     253   2020 |
</span></span><span style="display:flex;"><span>     +----------------------------------------------------------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this step, I also set two global variables that will be repeatedly used in the subsequent procedures.</p>
<ol>
<li>the variable names in the VAR system <code>names</code></li>
<li>the number of observations in the dataset unit <code>rownum</code></li>
</ol>
<p>The codes for this step are as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-7">7</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">load</span> <span style="color:#111">dataset</span> <span style="color:#111">unit</span>
</span></span><span style="display:flex;"><span><span style="color:#111">use</span> <span style="color:#111">sampledata2020</span><span style="color:#111">,</span><span style="color:#111">replace</span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">keep</span> <span style="color:#00a8c8">if</span> <span style="color:#111">cusipcode</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#111">list</span><span style="color:#111">,</span> <span style="color:#111">nolabel</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">set</span> <span style="color:#111">global</span> <span style="color:#111">variables</span>
</span></span><span style="display:flex;"><span><span style="color:#111">global</span> <span style="color:#111">names</span> <span style="color:#d88200">&#34;rm x r&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">global</span> <span style="color:#111">rownum</span> <span style="color:#f92672">=</span> <span style="color:#111">_N</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="implement-brogaard-decomposition">Implement Brogaard Decomposition</h2>
<p>For now, we&rsquo;ve collected all the necessary variables, and get the data ready for Brogaard decomposition. Before we actually start to estimate, I would like to provide a big picture for implementing the Brogaard decomposition in a single stock-year dataset.</p>
<p>The tasks we&rsquo;re going to resolve are as follows.</p>
<ol>
<li>
<p>Estimate the reduced-form VAR in Equation (1), saving the residuals \(e\) and variance/covariance matrix of residuals \(\Sigma_e\)</p>
</li>
<li>
<p>Estimate matrix \(B\), which specifies the contemporaneous effects among variables in the VAR system</p>
</li>
<li>
<p>Estimate the structural shocks \(\epsilon_t\) and their variance-covariance matrix \(\Sigma_\epsilon\)</p>
</li>
<li>
<p>Estimate the 15-step cumulative structural IRFs \(\theta_{rm}\), \(\theta_x\), \(\theta_r\), which represent the  (permanent) cumulative return responses of stock return \(r\) to unit structural shocks \(\varepsilon_{r_m, t}, \varepsilon_{x, t}, \varepsilon_{r, t}\) respectively</p>
</li>
<li>
<p>Combine the estimated variances of the structural innovations from step 3 with the long-run responses from step 4 to get the variance components of each information source using the following formula.
$$
\begin{aligned} \text { MktInfo } &amp;=\theta_{r_m}^2 \sigma_{\varepsilon_{r_m}}^2 \\\ \text { PrivateInfo } &amp;=\theta_x^2 \sigma_{\varepsilon_x}^2 \\\ \text { PublicInfo } &amp;=\theta_r^2 \sigma_{\varepsilon_r}^2. \end{aligned}
$$</p>
</li>
<li>
<p>Estimate the contemporaneous noise term with the following Equation
$$
\Delta s = r_t-a_0-\theta_{rm}\epsilon_{rm,t}-\theta_x\epsilon_{x,t}-\theta_r\epsilon_{r,t}
$$
As we&rsquo;re only interested in the variance of \(\Delta s\), which is by construct the variance from noise, we can ignore the constant term \(a_0\) and use the variance of \(\Delta s^*\) to represent the noise variance instead, where
$$
Noise = \sigma_s^2=Var(\Delta s)=Var(\Delta s^*)\\\
\Delta s^*=r_t-\theta_{rm}\epsilon_{rm,t}-\theta_x\epsilon_{x,t}-\theta_r\epsilon_{r,t}
$$</p>
</li>
<li>
<p>Get variance shares by normalizing these variance components
$$
\begin{aligned}
\text { MktInfoShare } &amp;=\theta_{r_m}^2 \sigma_{\varepsilon_{r_m}}^2 /(\sigma_w^2+\sigma_s^2 )\\\
\text { PrivateInfoShare } &amp;=\theta_{x}^2 \sigma_{\varepsilon_x}^2 /(\sigma_w^2+\sigma_s^2 ) \\\
\text { PublicInfoShare } &amp;=\theta_r^2 \sigma_{\varepsilon_r}^2 /(\sigma_w^2+\sigma_s^2 ) \\\
\text { NoiseShare } &amp;=\sigma_s^2 /(\sigma_w^2+\sigma_s^2 ) .
\end{aligned} \notag
$$</p>
</li>
</ol>
<p>​	where \(\sigma_w^2\) represents the sum of all information-based components in stock return volatility.
$$
\sigma_w^2 =\theta_{r_m}^2 \sigma_{\varepsilon_{r_m}}^2 +\theta_{x}^2 \sigma_{\varepsilon_{x}}^2 +\theta_{r}^2 \sigma_{\varepsilon_{r}}^2
$$</p>
<h3 id="step-1-estimate-var-coefficients-matrix-b-epsilon_t-sigma_e-and-sigma_epsilon">Step 1: Estimate VAR Coefficients, Matrix \(B\), \(\epsilon_t\), \(\Sigma_e\), and \(\Sigma_\epsilon\)</h3>
<p>I set the lag order as 5 to keep consistent with Broggard et al. (2022, RFS) and then I use <code>svar</code> model to estimate the VAR model, imposing a Cholesky type restriction to contemporaneous matrix \(B\) as mentioned in the paper.</p>
<p>The readers can see details about the matrix \(B\) in <a href="https://mengjiexu.com/post/manually-replicate-statas-practice-in-estimations-of-var-irfs-and-variance-decomposition/">Dig into Estimation of VAR Coefficients, IRFs, and Variance Decomposition in Stata</a> and see why <code>svar</code> command can directly estimate it in <a href="https://mengjiexu.com/post/common-practice-of-var-estimation-in-stata/">Estimations of VAR, IRFs, and Variance Decomposition in Stata</a>.</p>
<p>The codes for estimating the reduced-form model are as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-4">4</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">estimate</span> <span style="color:#111">B</span> <span style="color:#f92672">and</span> <span style="color:#111">coefficients</span> <span style="color:#111">of</span> <span style="color:#111">VAR</span>
</span></span><span style="display:flex;"><span><span style="color:#111">matrix</span> <span style="color:#111">A1</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">matrix</span> <span style="color:#111">B1</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#f92672">.</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">svar</span> <span style="color:#111">rm</span> <span style="color:#111">x</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">lags</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span><span style="color:#111">)</span> <span style="color:#111">aeq</span><span style="color:#111">(</span><span style="color:#111">A1</span><span style="color:#111">)</span> <span style="color:#111">beq</span><span style="color:#111">(</span><span style="color:#111">B1</span><span style="color:#111">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>svar</code> command stores the matrix \(B\) as <code>e(A)</code>, the coefficient matrix as <code>e(b_var)</code> and the variance/covariance matrix of residuals \(\Sigma_e\) as <code>e(Sigma)</code>. So I didn&rsquo;t estimate them once more but just take them directly from the results of <code>svar</code> estimation.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-4">4</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">store</span> <span style="color:#111">parameter</span> <span style="color:#111">matrix</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">B</span> <span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">(</span><span style="color:#111">A</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">coef</span> <span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">(</span><span style="color:#111">b_var</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">sigma_hat</span> <span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">(</span><span style="color:#111">Sigma</span><span style="color:#111">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I adjust the freedom of variance/covariance matrix of residuals generated from <code>svar</code> command <code>sigma_hat</code> from \(n-p\) to \(n-p-1\) and name the adjusted variance/covariance matrix as <code>sigma_e</code>, where \(n\) is the total number of the observations in the dataset and \(p\) is the number of lag orders, which is set as 5 following the paper. It shouldn&rsquo;t make much difference if the readers ignore this step. Note that as preidcting residuals needs \(p\)-lag variables, the residuals \(e\) by definition lose freedom of \(p\).</p>
<p>By definition,
$$
\epsilon_t=Be_t
$$
That also implies
$$
\Sigma_\epsilon=B\Sigma_eB&rsquo;
$$
With above formulas, we can calculate the structural shocks \(\epsilon_t\) and their variance/covariance matrix \(\Sigma_\epsilon\) as follows. I stored the structural shocks in a matrix named <code>epsilons</code> and the variance/covariance matrix of structural shocks in a matrix named <code>sigma_epsilon</code>.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-12">12</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">**</span> <span style="color:#111">get</span> <span style="color:#111">residuals</span> <span style="color:#111">e_t</span>
</span></span><span style="display:flex;"><span><span style="color:#111">foreach</span> <span style="color:#00a8c8">var</span> <span style="color:#111">of</span> <span style="color:#111">varlist</span> <span style="color:#111">rm</span> <span style="color:#111">x</span> <span style="color:#111">r</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">qui</span> <span style="color:#111">cap</span> <span style="color:#111">predict</span> <span style="color:#111">e_</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#00a8c8">var</span><span style="color:#d88200">&#39;, resi equation(`var&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">**</span> <span style="color:#111">get</span> <span style="color:#111">epsilons</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mkmat</span> <span style="color:#111">e_rm</span> <span style="color:#111">e_x</span> <span style="color:#111">e_r</span><span style="color:#111">,</span> <span style="color:#111">matrix</span><span style="color:#111">(</span><span style="color:#111">resi</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">epsilons</span> <span style="color:#f92672">=</span> <span style="color:#111">B</span><span style="color:#f92672">*</span><span style="color:#111">resi</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">get</span> <span style="color:#111">variance</span><span style="color:#f92672">-</span><span style="color:#111">covariance</span> <span style="color:#111">matrix</span> <span style="color:#111">of</span> <span style="color:#111">residuals</span> <span style="color:#f92672">and</span> <span style="color:#111">epsilons</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">sigma_e</span> <span style="color:#f92672">=</span> <span style="color:#111">sigma_hat</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">_N</span><span style="color:#f92672">-</span><span style="color:#ae81ff">5</span><span style="color:#111">)</span><span style="color:#f92672">/</span><span style="color:#111">(</span><span style="color:#111">_N</span><span style="color:#f92672">-</span><span style="color:#ae81ff">5</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">sigma_epsilon</span> <span style="color:#f92672">=</span> <span style="color:#111">B</span><span style="color:#f92672">*</span><span style="color:#111">sigma_e</span><span style="color:#f92672">*</span><span style="color:#d88200">B</span><span style="color:#d88200">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-2-estimate-15-step-cumulative-structural-irfs-theta_rm-theta_x-and-theta_r">Step 2: Estimate 15-step cumulative structural IRFs \(\theta_{rm}\), \(\theta_x\), and \(\theta_r\)</h3>
<p>While the <code>svar</code> command can produce the results for IRFs, Orthogonalized IRFs, and Orthogonalized Structural IRFs automatically, what we need are the <strong>un-orthogonalized Structural IRFs</strong>.</p>
<h4 id="procedures-for-estimating-theta">Procedures for estimating \(\theta\)</h4>
<p>The \(\theta\)s, which are the 15-step cumulative un-orthogonalized Structural IRFs, can be quickly and conveniently calculated via the following procedures (please see more details in <a href="https://mengjiexu.com/post/manually-replicate-statas-practice-in-estimations-of-var-irfs-and-variance-decomposition/">Dig into Estimation of VAR Coefficients, IRFs, and Variance Decomposition in Stata</a>).</p>
<ol>
<li>calculate the IRFs \(\Phi_i(i=1,2,3&hellip;,15)\) following the following formula, where \(k\) is the number of variables in the VAR system. \(A_j\) is the \(j\)-lag coefficient matrix for the 		reduced-form VAR</li>
</ol>
<p>$$
\Phi_0 = I_k\\\
\Phi_i = \Sigma_{j=1}^{i}\Phi_{i-j}A_j \tag{2}
$$</p>
<ol start="2">
<li>
<p>post-multiply IRF \(\Phi_i\) with \(B^{-1}\) to get (un-orthogonalized) structural IRFs \(\Lambda_i\) for each forward-looking step \(i=1,2,3,..,15\)
$$
\Lambda_i =\Phi_iB^{-1} \tag{3}
$$</p>
</li>
<li>
<p>Sum all the 15-step (un-orthogonalized) structural IRFs \(\Lambda_i\) to obtain the cumulative structural IRFs.</p>
</li>
<li>
<p>As we are only interested in the 15-step cumulative structural IRFs functioning on the stock returns, which are specified in the third equation in the VAR system, the \(\theta_{rm}\), \(\theta_x\), and \(\theta_r\) lie on the third row of the 15-step cumulative structural IRF matrix.</p>
</li>
</ol>
<h4 id="obtain-coefficient-matrix-a_jj125">Obtain coefficient matrix \(A_j(j=1,2,&hellip;,5)\)</h4>
<p>To implement the above procedures, the first thing we need to get are the reduced-form coefficient matrix \(A_j(j=1,2,&hellip;,5)\). As we have obtained all the reduce-form coefficients with <code>svar</code> command and stored them in a matrix <code>coef</code> in the last step, we don&rsquo;t have to compute them again but just need to reshape the matrix <code>coef</code> into the shape we need.</p>
<p>The coefficient matrix we currently have <code>coef</code> is a \(1\times 48\) matrix. I first reshape it to a \(3\times 16\) matrix named <code>newcoef</code>, where  each row contains the coefficients for one equation in the VAR system. Within each row, the coefficients are ordered with fixed rules: the coefficients for the first variable <code>rm</code> with 1 to 5 lags, the coefficients for the second variable <code>x</code> with 1 to 5 lags, the coefficients for the third variable <code>x</code> with 1 to 5 lags, and the constant for the corresponding equation. That implies, the coefficients for the same lag can always be found every 5 columns.</p>
<p>With the above observations, I generated matrix \(A_1\) to \(A_5\) with the following codes.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-13">13</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>* reshape coeficient matrix
</span></span><span style="display:flex;"><span>cap mat drop newcoef
</span></span><span style="display:flex;"><span>forvalues i = 1/3{
</span></span><span style="display:flex;"><span>	mat temp= coef[1..1, 1+16*(`i&#39;-1)..16*`i&#39;]
</span></span><span style="display:flex;"><span>	mat newcoef = nullmat(newcoef) \ temp
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>* generate a1 to a5
</span></span><span style="display:flex;"><span>forvalues i = 1/5{
</span></span><span style="display:flex;"><span>	mat A`i&#39; = (newcoef[1..3,`i&#39;], newcoef[1..3,`i&#39;+5], newcoef[1..3,`i&#39;+10])
</span></span><span style="display:flex;"><span>	mat rownames A`i&#39; = $names
</span></span><span style="display:flex;"><span>	mat colnames A`i&#39; = $names
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></td></tr></table>
</div>
</div><p>I list the 3-lag coefficient matrix \(A_3\) as an example to show the desired format of coefficient matrix  \(A_1\) to \(A_5\). For the \(ij\)-th element of the matrix \(A_j\), it represents the impact of one-unit reduced-form shock \(e_{jt}\) on the Equation with variable \(i\) as dependent variable.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-7">7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-8">8</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>. mat list A3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>A3[3,3]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            inflation      unrate         ffr
</span></span><span style="display:flex;"><span>inflation  -.06574644   .00181085  -.00500138
</span></span><span style="display:flex;"><span>   unrate   1.4581185   .04263687   -1.835178
</span></span><span style="display:flex;"><span>      ffr  -.01217184  -.00032878  -.06017122
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="calculate-irfs-and-cumulative-un-orthogonalized-structural-irfs">Calculate IRFs and cumulative un-orthogonalized Structural IRFs</h4>
<p>To this stage, we&rsquo;ve made it clear about the formulas of calculating the IRFs and un-orthogonalized Structural IRFs (please see Equation (2) and (3)) and obtained all the necessary ingredients (coefficient matrix \(A_i\) and matrix \(B\)) for the calculations.</p>
<p>The codes for calculating IRFs and cumulative un-orthogonalized Structural IRFs are as follows. I summed up all the un-orthogonalized Structural IRF matrix step by step to get the 15-step cumulative un-orthogonalized Structural IRFs and name it as <code>csirf</code>.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-17">17</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>* calculate IRFs and cumulative un-orthogonalized Structural IRFs
</span></span><span style="display:flex;"><span>mat irf0 = I(3)
</span></span><span style="display:flex;"><span>mat sirf0 = irf0*inv(B)
</span></span><span style="display:flex;"><span>mat csirf = sirf0
</span></span><span style="display:flex;"><span>forvalues i=1/15{
</span></span><span style="display:flex;"><span>	mat irf`i&#39; = J(3,3,0)
</span></span><span style="display:flex;"><span>    forvalues j = 1/5{
</span></span><span style="display:flex;"><span>    if `i&#39; &gt;= `j&#39;{
</span></span><span style="display:flex;"><span>        local temp = `i&#39;-`j&#39;
</span></span><span style="display:flex;"><span>        mat temp2 = irf`temp&#39;*A`j&#39;
</span></span><span style="display:flex;"><span>        mat irf`i&#39; = irf`i&#39;+ temp2
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    mat sirf`i&#39; = irf`i&#39;*inv(B)
</span></span><span style="display:flex;"><span>    mat csirf = csirf + sirf`i&#39;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>mat rownames csirf = $names
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="extract-theta">Extract \(\theta\)</h4>
<p>The 15-step cumulative un-orthogonalized Structural IRF matrix <code>csirf</code> is as follows. The \(ij\)-th element of this matrix represents the permanent (cumulative) impact of one-unit structural shock \(\epsilon_{j,t}\) on the \(i\)-th Equation in the VAR system.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-7">7</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>. mat list csirf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>csirf[3,3]
</span></span><span style="display:flex;"><span>            rm           x           r
</span></span><span style="display:flex;"><span>rm   1.0590505   .00356754   .00036924
</span></span><span style="display:flex;"><span> x   11.662946   .84352094  -1.0125034
</span></span><span style="display:flex;"><span> r   .94265444   .01400394   .76133195
</span></span></code></pre></td></tr></table>
</div>
</div><p>By definition, the elements in the 3rd row of the matrix <code>csirf</code> are \(\theta_{rm}\), \(\theta_x\), and \(\theta_r\) respectively.</p>
<p>Thus, we can extract thetas from the matrix <code>csirf</code> and save the thetas into a new matrix named <code>theta</code>.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-11-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-11-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-11-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-11-2">2</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>* extract thetas
</span></span><span style="display:flex;"><span>mat theta = csirf[3..3, 1..3]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-3-calculate-noise-term">Step 3: Calculate noise term</h3>
<p>As we&rsquo;ve discussed in the road map, the noise variance is given by the following formula.
$$
Noise = \sigma_s^2=Var(\Delta s)=Var(\Delta s^*)\\\
\Delta s^*=r_t-\theta_{rm}\epsilon_{rm,t}-\theta_x\epsilon_{x,t}-\theta_r\epsilon_{r,t}
$$
Intuitively, we need to first calculate \(\Delta s^*\) by substracting the combinations of structural shocks \(\epsilon_t\) and the permanent impact of structural shocks on stock returns \(\theta\) from the contemporaneous stock return \(r_t\).</p>
<p>As we&rsquo;ve saved the structural shocks \(\epsilon_t\) in a matrix named <code>epsilons</code> and the permanent impact of structural shocks on stock returns \(\theta\) in a matrix named <code>theta</code>, the contemporaneous noise term \(\Delta s^*\) can be calculated with the following codes, where I save the noise term into a matrix named <code>delta_s</code>.</p>
<p>To more conveniently produce the variance of the noise term, I saved the noise term matrix <code>delta_s</code> into a new column named <code>delta_s</code> in the dataset.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>* calculate noise
</span></span><span style="display:flex;"><span>mkmat r, matrix(r)
</span></span><span style="display:flex;"><span>mat delta_s = r - (theta*epsilons)&#39;
</span></span><span style="display:flex;"><span>mat colnames delta_s = &#34;delta_s&#34;
</span></span><span style="display:flex;"><span>svmat delta_s, names(col)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-4-calculate-the-variance-from-each-component">Step 4: Calculate the variance from each component</h3>
<p>Till now, we&rsquo;ve collected all the ingredients needed to compute the variance contribution of all the four components defined by the Brogaard et al. (2022, RFS).</p>
<p>Firstly, we calculate the variance contribution from three-types of information with the following formula.
$$
\begin{aligned} \text { MktInfo } &amp;=\theta_{r_m}^2 \sigma_{\varepsilon_{r_m}}^2 \\\ \text { PrivateInfo } &amp;=\theta_x^2 \sigma_{\varepsilon_x}^2 \\\ \text { PublicInfo } &amp;=\theta_r^2 \sigma_{\varepsilon_r}^2. \end{aligned}
$$
As we&rsquo;ve saved the thetas in a matrix <code>theta</code> and the variance/covariance matrix of structural shocks \(\epsilon_t\) into a matrix <code>sigma_epsilon</code>, we can calculate the information-based variances as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-7">7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-8">8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-13-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-13-9">9</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">**</span> <span style="color:#111">calculate</span> <span style="color:#111">information</span> <span style="color:#111">part</span> <span style="color:#111">variance</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">var_epsilon</span> <span style="color:#f92672">=</span> <span style="color:#111">vecdiag</span><span style="color:#111">(</span><span style="color:#111">sigma_epsilon</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">J</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">forvalues</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">brogaard</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;]=theta[1, `i&#39;</span><span style="color:#111">]</span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#111">var_epsilon</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">brogaard</span>\<span style="color:#111">theta</span>\<span style="color:#111">var_epsilon</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">rownames</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">varpart</span> <span style="color:#111">theta</span> <span style="color:#111">var_epsilon</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">colnames</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#111">names</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that I put all the variance components along with the related parameters \(\theta\) and \(\sigma_\epsilon\) into a new matrix named <code>brogaard</code>. This matrix looks like as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-14-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-14-7">7</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">.</span> <span style="color:#111">mat</span> <span style="color:#111">list</span> <span style="color:#111">brogaard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">brogaard</span><span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#111">rm</span>          <span style="color:#111">x</span>          <span style="color:#111">r</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">varpart</span>  <span style="color:#ae81ff">17853.028</span>  <span style="color:#ae81ff">7822.3944</span>   <span style="color:#ae81ff">56653.64</span>
</span></span><span style="display:flex;"><span>      <span style="color:#111">theta</span>  <span style="color:#f92672">.</span><span style="color:#ae81ff">94265444</span>  <span style="color:#f92672">.</span><span style="color:#ae81ff">01400394</span>  <span style="color:#f92672">.</span><span style="color:#ae81ff">76133195</span>
</span></span><span style="display:flex;"><span><span style="color:#111">var_epsilon</span>  <span style="color:#ae81ff">20091.245</span>   <span style="color:#ae81ff">39887749</span>   <span style="color:#ae81ff">97741.66</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Secondly, I calculate the variance contribution from noise, which is proxied by the variance of \(\Delta_s^*\) we&rsquo;ve calculated above. Of course, I add the noise variance into the result matrix <code>brogaard</code>.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-15-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-15-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-15-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-15-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-15-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-15-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-15-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-15-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-15-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-15-5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">**</span> <span style="color:#111">calculate</span> <span style="color:#111">noise</span> <span style="color:#111">part</span> <span style="color:#111">variance</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">J</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">))</span><span style="color:#d88200">&#39; </span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">sum</span> <span style="color:#111">delta_s</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">brogaard</span><span style="color:#111">[</span><span style="color:#ae81ff">4</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">(</span><span style="color:#111">sd</span><span style="color:#111">)</span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#111">mat</span> <span style="color:#111">rownames</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#111">names</span> <span style="color:#d88200">&#34;s&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After this step, we&rsquo;ve figured out the variance contribution from each component defined by the Brogaard paper and saved them into the result matrix <code>brogaard</code>.</p>
<p>The final result matrix <code>brogaard</code> is as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-7">7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-16-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-16-8">8</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">.</span> <span style="color:#111">mat</span> <span style="color:#111">list</span> <span style="color:#111">brogaard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">brogaard</span><span style="color:#111">[</span><span style="color:#ae81ff">4</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">varpart</span>        <span style="color:#111">theta</span>  <span style="color:#111">var_epsilon</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rm</span>    <span style="color:#ae81ff">17853.028</span>    <span style="color:#f92672">.</span><span style="color:#ae81ff">94265444</span>    <span style="color:#ae81ff">20091.245</span>
</span></span><span style="display:flex;"><span> <span style="color:#111">x</span>    <span style="color:#ae81ff">7822.3944</span>    <span style="color:#f92672">.</span><span style="color:#ae81ff">01400394</span>     <span style="color:#ae81ff">39887749</span>
</span></span><span style="display:flex;"><span> <span style="color:#111">r</span>     <span style="color:#ae81ff">56653.64</span>    <span style="color:#f92672">.</span><span style="color:#ae81ff">76133195</span>     <span style="color:#ae81ff">97741.66</span>
</span></span><span style="display:flex;"><span> <span style="color:#111">s</span>    <span style="color:#ae81ff">20275.294</span>            <span style="color:#ae81ff">0</span>            <span style="color:#ae81ff">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="step-5-calculate-variance-contribution">Step 5: Calculate variance contribution</h3>
<p>To more conveniently calculate the variance contribution, I saved the result matrix <code>brogaard</code> into the dataset.  I follow the following formula to calculate the variance contribution of each component and save the percentages into a new variable named <code>varpct</code>.
$$
\begin{aligned}
\text { MktInfoShare } &amp;=\theta_{r_m}^2 \sigma_{\varepsilon_{r_m}}^2 /(\sigma_w^2+\sigma_s^2 )\\\
\text { PrivateInfoShare } &amp;=\theta_{x}^2 \sigma_{\varepsilon_x}^2 /(\sigma_w^2+\sigma_s^2 ) \\\
\text { PublicInfoShare } &amp;=\theta_r^2 \sigma_{\varepsilon_r}^2 /(\sigma_w^2+\sigma_s^2 ) \\\
\text { NoiseShare } &amp;=\sigma_s^2 /(\sigma_w^2+\sigma_s^2 ) .
\end{aligned} \notag
$$
where \(\sigma_w^2\) represents the sum of all information-based components in stock return volatility.
$$
\sigma_w^2 =\theta_{r_m}^2 \sigma_{\varepsilon_{r_m}}^2 +\theta_{x}^2 \sigma_{\varepsilon_{x}}^2 +\theta_{r}^2 \sigma_{\varepsilon_{r}}^2
$$</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-17-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-17-11">11</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#111">keep</span> <span style="color:#111">cusip</span> <span style="color:#111">year</span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">keep</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">svmat</span> <span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">names</span><span style="color:#111">(</span><span style="color:#111">col</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">g</span> <span style="color:#111">rownames</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#111">local</span> <span style="color:#111">index</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#111">foreach</span> <span style="color:#111">name</span> <span style="color:#f92672">in</span> <span style="color:#f92672">$</span><span style="color:#111">names</span> <span style="color:#d88200">&#34;s&#34;</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">qui</span> <span style="color:#111">replace</span> <span style="color:#111">rownames</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;`name&#39;&#34;</span> <span style="color:#00a8c8">if</span> <span style="color:#111">_n</span> <span style="color:#f92672">==</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">index</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">local</span> <span style="color:#111">index</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">index</span><span style="color:#d88200">&#39; + 1</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">egen</span> <span style="color:#111">fullvar</span> <span style="color:#f92672">=</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">varpart</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">qui</span> <span style="color:#111">g</span> <span style="color:#111">varpct</span> <span style="color:#f92672">=</span> <span style="color:#111">varpart</span><span style="color:#f92672">/</span><span style="color:#111">fullvar</span><span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The saved dataset is as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-7">7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-18-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-18-8">8</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>    <span style="color:#f92672">+-----------------------------------------------------------------------------------+</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">|</span>    <span style="color:#111">cusip</span>   <span style="color:#111">year</span>    <span style="color:#111">varpart</span>      <span style="color:#111">theta</span>   <span style="color:#111">var_ep</span><span style="color:#f92672">~</span><span style="color:#111">n</span>   <span style="color:#111">rownames</span>    <span style="color:#111">fullvar</span>     <span style="color:#111">varpct</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">|-----------------------------------------------------------------------------------|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">1.</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">00032</span><span style="color:#111">Q10</span>   <span style="color:#ae81ff">2020</span>   <span style="color:#ae81ff">17853.03</span>   <span style="color:#f92672">.</span><span style="color:#ae81ff">9426544</span>   <span style="color:#ae81ff">20091.25</span>         <span style="color:#111">rm</span>   <span style="color:#ae81ff">102604.4</span>   <span style="color:#ae81ff">17.39987</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">2.</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">00032</span><span style="color:#111">Q10</span>   <span style="color:#ae81ff">2020</span>   <span style="color:#ae81ff">7822.395</span>   <span style="color:#f92672">.</span><span style="color:#ae81ff">0140039</span>   <span style="color:#ae81ff">3.99e+07</span>          <span style="color:#111">x</span>   <span style="color:#ae81ff">102604.4</span>   <span style="color:#ae81ff">7.623842</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3.</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">00032</span><span style="color:#111">Q10</span>   <span style="color:#ae81ff">2020</span>   <span style="color:#ae81ff">56653.64</span>    <span style="color:#f92672">.</span><span style="color:#ae81ff">761332</span>   <span style="color:#ae81ff">97741.66</span>          <span style="color:#111">r</span>   <span style="color:#ae81ff">102604.4</span>   <span style="color:#ae81ff">55.21563</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">4.</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">00032</span><span style="color:#111">Q10</span>   <span style="color:#ae81ff">2020</span>   <span style="color:#ae81ff">20275.29</span>          <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>          <span style="color:#111">s</span>   <span style="color:#ae81ff">102604.4</span>   <span style="color:#ae81ff">19.76065</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">+-----------------------------------------------------------------------------------+</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="pack-codes">Pack codes</h2>
<p>Remember the Broggard decomposition is implemented in stock-year level. That means we need to loop over the above codes over the daily observations of each stock in each year. That requires an efficient packing of the codes.</p>
<p>There are two issues worth noted in the packing procedures.</p>
<ol>
<li>I require there are at least 50 observations for the estimation of the VAR model
<ul>
<li>otherwise, the VAR estimation doesn&rsquo;t converge or lacks vaidility with too few freedoms</li>
</ul>
</li>
<li>I require the estimation of VAR model converges
<ul>
<li>otherwise, it&rsquo;s not possible to get converged residuals, which are the prerequisite for the subsequent calculations</li>
</ul>
</li>
</ol>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-1">  1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-2">  2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-3">  3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-4">  4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-5">  5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-6">  6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-7">  7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-8">  8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-9">  9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-10"> 10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-11"> 11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-12"> 12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-13"> 13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-14"> 14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-15"> 15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-16"> 16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-17"> 17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-18"> 18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-19"> 19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-20"> 20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-21"> 21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-22"> 22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-23"> 23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-24"> 24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-25"> 25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-26"> 26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-27"> 27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-28"> 28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-29"> 29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-30"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-30"> 30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-31"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-31"> 31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-32"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-32"> 32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-33"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-33"> 33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-34"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-34"> 34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-35"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-35"> 35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-36"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-36"> 36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-37"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-37"> 37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-38"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-38"> 38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-39"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-39"> 39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-40"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-40"> 40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-41"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-41"> 41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-42"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-42"> 42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-43"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-43"> 43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-44"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-44"> 44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-45"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-45"> 45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-46"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-46"> 46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-47"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-47"> 47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-48"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-48"> 48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-49"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-49"> 49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-50"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-50"> 50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-51"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-51"> 51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-52"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-52"> 52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-53"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-53"> 53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-54"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-54"> 54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-55"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-55"> 55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-56"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-56"> 56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-57"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-57"> 57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-58"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-58"> 58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-59"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-59"> 59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-60"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-60"> 60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-61"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-61"> 61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-62"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-62"> 62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-63"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-63"> 63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-64"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-64"> 64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-65"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-65"> 65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-66"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-66"> 66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-67"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-67"> 67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-68"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-68"> 68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-69"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-69"> 69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-70"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-70"> 70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-71"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-71"> 71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-72"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-72"> 72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-73"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-73"> 73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-74"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-74"> 74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-75"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-75"> 75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-76"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-76"> 76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-77"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-77"> 77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-78"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-78"> 78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-79"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-79"> 79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-80"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-80"> 80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-81"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-81"> 81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-82"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-82"> 82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-83"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-83"> 83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-84"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-84"> 84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-85"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-85"> 85</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-86"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-86"> 86</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-87"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-87"> 87</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-88"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-88"> 88</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-89"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-89"> 89</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-90"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-90"> 90</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-91"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-91"> 91</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-92"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-92"> 92</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-93"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-93"> 93</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-94"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-94"> 94</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-95"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-95"> 95</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-96"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-96"> 96</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-97"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-97"> 97</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-98"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-98"> 98</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-99"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-99"> 99</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-100"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-100">100</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-101"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-101">101</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-102"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-102">102</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-103"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-103">103</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-104"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-104">104</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-105"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-105">105</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-106"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-106">106</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-107"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-107">107</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-108"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-108">108</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-109"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-109">109</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-110"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-110">110</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-111"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-111">111</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-19-112"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-19-112">112</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#111">cap</span> <span style="color:#111">program</span> <span style="color:#111">drop</span> <span style="color:#111">loopb</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cap</span> <span style="color:#111">program</span> <span style="color:#111">define</span> <span style="color:#111">loopb</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">use</span> <span style="color:#111">sampledata</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">2</span><span style="color:#d88200">&#39;,replace</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">qui</span> <span style="color:#111">keep</span> <span style="color:#00a8c8">if</span> <span style="color:#111">cusipcode</span> <span style="color:#f92672">==</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">1</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#00a8c8">if</span> <span style="color:#111">_N</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">50</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">set</span> <span style="color:#111">global</span> <span style="color:#111">variables</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">global</span> <span style="color:#111">names</span> <span style="color:#d88200">&#34;rm x r&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">global</span> <span style="color:#111">rownum</span> <span style="color:#f92672">=</span> <span style="color:#111">_N</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">estimate</span> <span style="color:#111">B</span> <span style="color:#f92672">and</span> <span style="color:#111">coefficients</span> <span style="color:#111">of</span> <span style="color:#111">VAR</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">matrix</span> <span style="color:#111">A1</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">matrix</span> <span style="color:#111">B1</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#f92672">.</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span> \ <span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#f92672">.</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">qui</span> <span style="color:#111">svar</span> <span style="color:#111">rm</span> <span style="color:#111">x</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">lags</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span><span style="color:#111">)</span> <span style="color:#111">aeq</span><span style="color:#111">(</span><span style="color:#111">A1</span><span style="color:#111">)</span> <span style="color:#111">beq</span><span style="color:#111">(</span><span style="color:#111">B1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">B</span> <span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">(</span><span style="color:#111">A</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">coef</span> <span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">(</span><span style="color:#111">b_var</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">sigma_hat</span> <span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">(</span><span style="color:#111">Sigma</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">get</span> <span style="color:#111">coefficient</span> <span style="color:#111">matrix</span> <span style="color:#111">of</span> <span style="color:#00a8c8">var</span> <span style="color:#111">a1</span><span style="color:#f92672">-</span><span style="color:#111">a5</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">reshape</span> <span style="color:#111">coeficient</span> <span style="color:#111">matrix</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">cap</span> <span style="color:#111">mat</span> <span style="color:#111">drop</span> <span style="color:#111">newcoef</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">forvalues</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">temp</span><span style="color:#f92672">=</span> <span style="color:#111">coef</span><span style="color:#111">[</span><span style="color:#ae81ff">1.</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">16</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;-1)..16*`i&#39;</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">newcoef</span> <span style="color:#f92672">=</span> <span style="color:#111">nullmat</span><span style="color:#111">(</span><span style="color:#111">newcoef</span><span style="color:#111">)</span> \ <span style="color:#111">temp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">generate</span> <span style="color:#111">a1</span> <span style="color:#111">to</span> <span style="color:#111">a5</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">forvalues</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">A</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; = (newcoef[1..3,`i&#39;</span><span style="color:#111">],</span> <span style="color:#111">newcoef</span><span style="color:#111">[</span><span style="color:#ae81ff">1.</span><span style="color:#f92672">.</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;+5], newcoef[1..3,`i&#39;</span><span style="color:#f92672">+</span><span style="color:#ae81ff">10</span><span style="color:#111">])</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">rownames</span> <span style="color:#111">A</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; = $names</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">colnames</span> <span style="color:#111">A</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; = $names</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">get</span> <span style="color:#ae81ff">15</span><span style="color:#f92672">-</span><span style="color:#111">step</span> <span style="color:#111">coefficients</span> <span style="color:#111">of</span> <span style="color:#111">VMA</span> <span style="color:#111">(</span><span style="color:#111">irf</span><span style="color:#111">),</span> <span style="color:#111">structual</span> <span style="color:#111">irf</span> <span style="color:#111">(</span><span style="color:#111">sirf</span><span style="color:#111">),</span> <span style="color:#f92672">and</span> <span style="color:#111">cumulative</span> <span style="color:#111">sirf</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">irf0</span> <span style="color:#f92672">=</span> <span style="color:#111">I</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">sirf0</span> <span style="color:#f92672">=</span> <span style="color:#111">irf0</span><span style="color:#f92672">*</span><span style="color:#111">inv</span><span style="color:#111">(</span><span style="color:#111">B</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">csirf</span> <span style="color:#f92672">=</span> <span style="color:#111">sirf0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">forvalues</span> <span style="color:#111">i</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">15</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">irf</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; = J(3,3,0)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">forvalues</span> <span style="color:#111">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#00a8c8">if</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; &gt;= `j&#39;</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">local</span> <span style="color:#111">temp</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;-`j&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">temp2</span> <span style="color:#f92672">=</span> <span style="color:#111">irf</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">temp</span><span style="color:#d88200">&#39;*A`j&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">irf</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; = irf`i&#39;</span><span style="color:#f92672">+</span> <span style="color:#111">temp2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">sirf</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; = irf`i&#39;</span><span style="color:#f92672">*</span><span style="color:#111">inv</span><span style="color:#111">(</span><span style="color:#111">B</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">csirf</span> <span style="color:#f92672">=</span> <span style="color:#111">csirf</span> <span style="color:#f92672">+</span> <span style="color:#111">sirf</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">extract</span> <span style="color:#111">thetas</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">mat</span> <span style="color:#111">theta</span> <span style="color:#f92672">=</span> <span style="color:#111">csirf</span><span style="color:#111">[</span><span style="color:#ae81ff">3.</span><span style="color:#f92672">.</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#ae81ff">1.</span><span style="color:#f92672">.</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span> <span style="color:#111">get</span> <span style="color:#111">reisduals</span><span style="color:#111">,</span> <span style="color:#111">epsilons</span><span style="color:#111">,</span> <span style="color:#f92672">and</span> <span style="color:#111">their</span> <span style="color:#111">variance</span><span style="color:#f92672">-</span><span style="color:#111">covariance</span> <span style="color:#111">matrix</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">**</span> <span style="color:#111">get</span> <span style="color:#111">residuals</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">foreach</span> <span style="color:#00a8c8">var</span> <span style="color:#111">of</span> <span style="color:#111">varlist</span> <span style="color:#111">rm</span> <span style="color:#111">x</span> <span style="color:#111">r</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">cap</span> <span style="color:#111">predict</span> <span style="color:#111">e_</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#00a8c8">var</span><span style="color:#d88200">&#39;, resi equation(`var&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#111">capture</span> <span style="color:#111">confirm</span> <span style="color:#111">variable</span> <span style="color:#111">e_rm</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">_rc</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span><span style="color:#111">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">**</span> <span style="color:#111">get</span> <span style="color:#111">epsilons</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mkmat</span> <span style="color:#111">e_rm</span> <span style="color:#111">e_x</span> <span style="color:#111">e_r</span><span style="color:#111">,</span> <span style="color:#111">matrix</span><span style="color:#111">(</span><span style="color:#111">resi</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">epsilons</span> <span style="color:#f92672">=</span> <span style="color:#111">B</span><span style="color:#f92672">*</span><span style="color:#111">resi</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">**</span> <span style="color:#111">get</span> <span style="color:#111">variance</span><span style="color:#f92672">-</span><span style="color:#111">covariance</span> <span style="color:#111">matrix</span> <span style="color:#111">of</span> <span style="color:#111">residuals</span> <span style="color:#f92672">and</span> <span style="color:#111">epsilons</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">sigma_e</span> <span style="color:#f92672">=</span> <span style="color:#111">sigma_hat</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">_N</span><span style="color:#f92672">-</span><span style="color:#ae81ff">5</span><span style="color:#111">)</span><span style="color:#f92672">/</span><span style="color:#111">(</span><span style="color:#111">_N</span><span style="color:#f92672">-</span><span style="color:#ae81ff">5</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">sigma_epsilon</span> <span style="color:#f92672">=</span> <span style="color:#111">B</span><span style="color:#f92672">*</span><span style="color:#111">sigma_e</span><span style="color:#f92672">*</span><span style="color:#d88200">B</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">*</span> <span style="color:#111">calculate</span> <span style="color:#111">noise</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mkmat</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">matrix</span><span style="color:#111">(</span><span style="color:#111">r</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">delta_s</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">(</span><span style="color:#111">theta</span><span style="color:#f92672">*</span><span style="color:#111">epsilons</span><span style="color:#111">)</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">colnames</span> <span style="color:#111">delta_s</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;delta_s&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">svmat</span> <span style="color:#111">delta_s</span><span style="color:#111">,</span> <span style="color:#111">names</span><span style="color:#111">(</span><span style="color:#111">col</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">*</span> <span style="color:#111">calculate</span> <span style="color:#111">variance</span> <span style="color:#111">decomposition</span> <span style="color:#111">of</span> <span style="color:#111">each</span> <span style="color:#111">part</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">**</span> <span style="color:#111">calculate</span> <span style="color:#111">information</span> <span style="color:#111">part</span> <span style="color:#111">variance</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">var_epsilon</span> <span style="color:#f92672">=</span> <span style="color:#111">vecdiag</span><span style="color:#111">(</span><span style="color:#111">sigma_epsilon</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">J</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">forvalues</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">mat</span> <span style="color:#111">brogaard</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;]=theta[1, `i&#39;</span><span style="color:#111">]</span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#111">var_epsilon</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39;]</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">brogaard</span>\<span style="color:#111">theta</span>\<span style="color:#111">var_epsilon</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">rownames</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">varpart</span> <span style="color:#111">theta</span> <span style="color:#111">var_epsilon</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">colnames</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#111">names</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">**</span> <span style="color:#111">calculate</span> <span style="color:#111">noise</span> <span style="color:#111">part</span> <span style="color:#111">variance</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">J</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">))</span><span style="color:#d88200">&#39; </span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">sum</span> <span style="color:#111">delta_s</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">brogaard</span><span style="color:#111">[</span><span style="color:#ae81ff">4</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">(</span><span style="color:#111">sd</span><span style="color:#111">)</span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">mat</span> <span style="color:#111">rownames</span> <span style="color:#111">brogaard</span> <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#111">names</span> <span style="color:#d88200">&#34;s&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">*</span><span style="color:#111">mat</span> <span style="color:#111">list</span> <span style="color:#111">brogaard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">**</span> <span style="color:#111">save</span> <span style="color:#111">the</span> <span style="color:#111">variance</span> <span style="color:#111">decomposition</span> <span style="color:#111">results</span> 
</span></span><span style="display:flex;"><span>		<span style="color:#111">keep</span> <span style="color:#111">cusip</span> <span style="color:#111">year</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">keep</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">svmat</span> <span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">names</span><span style="color:#111">(</span><span style="color:#111">col</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">g</span> <span style="color:#111">rownames</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">local</span> <span style="color:#111">index</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">foreach</span> <span style="color:#111">name</span> <span style="color:#f92672">in</span> <span style="color:#f92672">$</span><span style="color:#111">names</span> <span style="color:#d88200">&#34;s&#34;</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">qui</span> <span style="color:#111">replace</span> <span style="color:#111">rownames</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;`name&#39;&#34;</span> <span style="color:#00a8c8">if</span> <span style="color:#111">_n</span> <span style="color:#f92672">==</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">index</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#111">local</span> <span style="color:#111">index</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">index</span><span style="color:#d88200">&#39; + 1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">egen</span> <span style="color:#111">fullvar</span> <span style="color:#f92672">=</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">varpart</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">g</span> <span style="color:#111">varpct</span> <span style="color:#f92672">=</span> <span style="color:#111">varpart</span><span style="color:#f92672">/</span><span style="color:#111">fullvar</span><span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">*</span> <span style="color:#111">save</span> <span style="color:#111">final</span> <span style="color:#111">results</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">local</span> <span style="color:#111">savename</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;C:\Users\xu-m\Documents</span><span style="color:#8045ff">\t</span><span style="color:#d88200">estVAR</span><span style="color:#8045ff">\r</span><span style="color:#d88200">esvardecompose</span><span style="color:#8045ff">\b</span><span style="color:#d88200">rogaard_&#39;$cusip&#39;_$year.dta&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">qui</span> <span style="color:#111">save</span> <span style="color:#d88200">&#34;`savename&#39;&#34;</span><span style="color:#111">,</span> <span style="color:#111">replace</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">end</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="loop-over-sample">Loop over sample</h2>
<p>I run the packed code over stocks in each year and collected all the results for different years together. Then I reshaped the dataset into panel data. The codes are as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-28">28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-29">29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-30"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-30">30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-31"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-31">31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-32"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-32">32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-33"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-33">33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-34"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-34">34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-35"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-35">35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-36"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-36">36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-37"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-37">37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-38"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-38">38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-39"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-39">39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-40"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-40">40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-41"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-41">41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-42"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-42">42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-43"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-43">43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-44"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-44">44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-45"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-45">45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-46"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-46">46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-47"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-47">47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-48"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-48">48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-49"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-49">49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-50"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-50">50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-51"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-51">51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-52"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-52">52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-53"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-53">53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-54"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-54">54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-55"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-55">55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-56"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-56">56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-20-57"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-20-57">57</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#111">cd</span> <span style="color:#111">C</span><span style="color:#111">:</span>\<span style="color:#111">Users</span>\<span style="color:#111">xu</span><span style="color:#f92672">-</span><span style="color:#111">m</span>\<span style="color:#111">Documents</span>\<span style="color:#111">testVAR</span>\<span style="color:#111">resvardecompose</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">execute</span> <span style="color:#111">brogaard</span> <span style="color:#111">decomposition</span> <span style="color:#00a8c8">for</span> <span style="color:#111">each</span> <span style="color:#111">stock</span><span style="color:#f92672">-</span><span style="color:#111">year</span>
</span></span><span style="display:flex;"><span><span style="color:#111">forvalues</span> <span style="color:#111">j</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2005</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2021</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">clear</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">set</span> <span style="color:#111">obs</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">save</span> <span style="color:#111">rescollect</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">j</span><span style="color:#d88200">&#39;, emptyok</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">use</span> <span style="color:#111">sampledata</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">j</span><span style="color:#d88200">&#39;,replace</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">qui</span> <span style="color:#111">sum</span> <span style="color:#111">cusipcode</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">local</span> <span style="color:#111">ub</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">(</span><span style="color:#111">max</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">forvalues</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">ub</span><span style="color:#d88200">&#39;{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">di</span> <span style="color:#d88200">&#34;`j&#39; `i&#39; of `ub&#39;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">loopb</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">i</span><span style="color:#d88200">&#39; `j&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">collect</span> <span style="color:#111">results</span> <span style="color:#00a8c8">for</span> <span style="color:#111">each</span> <span style="color:#111">year</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cap</span> <span style="color:#111">program</span> <span style="color:#111">drop</span> <span style="color:#111">collectbroggardbyyear</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cap</span> <span style="color:#111">program</span> <span style="color:#111">define</span> <span style="color:#111">collectbroggardbyyear</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">clear</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">set</span> <span style="color:#111">obs</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">save</span> <span style="color:#111">brogaard</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">1</span><span style="color:#d88200">&#39;, replace emptyok</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">local</span> <span style="color:#111">ff</span> <span style="color:#111">:</span> <span style="color:#111">dir</span> <span style="color:#f92672">.</span> <span style="color:#111">files</span> <span style="color:#d88200">&#34;*_`1&#39;.dta&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">local</span> <span style="color:#111">yearnum</span> <span style="color:#111">:</span> <span style="color:#111">word</span> <span style="color:#111">count</span> <span style="color:#d88200">&#34;`ff&#39;&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">local</span> <span style="color:#111">index</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">foreach</span> <span style="color:#111">f</span> <span style="color:#111">of</span> <span style="color:#111">local</span> <span style="color:#111">ff</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">append</span> <span style="color:#111">using</span> <span style="color:#d88200">&#34;`f&#39;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">di</span> <span style="color:#d88200">&#34;`index&#39; of `yearnum&#39; in year `1&#39;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">local</span> <span style="color:#111">index</span> <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">index</span><span style="color:#d88200">&#39; + 1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">save</span> <span style="color:#111">brogaard</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">1</span><span style="color:#d88200">&#39;, replace </span>
</span></span><span style="display:flex;"><span><span style="color:#111">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">collect</span> <span style="color:#111">all</span> <span style="color:#111">years</span>
</span></span><span style="display:flex;"><span><span style="color:#111">clear</span> 
</span></span><span style="display:flex;"><span><span style="color:#111">set</span> <span style="color:#111">obs</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#111">save</span> <span style="color:#f92672">../</span><span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">replace</span> <span style="color:#111">emptyok</span>
</span></span><span style="display:flex;"><span><span style="color:#111">forvalues</span> <span style="color:#111">year</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2005</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2021</span><span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">collectbroggardbyyear</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">year</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">use</span> <span style="color:#f92672">../</span><span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">replace</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">append</span> <span style="color:#111">using</span> <span style="color:#111">brogaard</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#111">year</span><span style="color:#d88200">&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#111">save</span> <span style="color:#f92672">../</span><span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">replace</span> 
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#111">reshape</span> <span style="color:#111">into</span> <span style="color:#111">panel</span> <span style="color:#111">data</span>
</span></span><span style="display:flex;"><span><span style="color:#111">cd</span> <span style="color:#f92672">../</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">use</span> <span style="color:#111">brogaard</span><span style="color:#111">,</span> <span style="color:#111">replace</span>
</span></span><span style="display:flex;"><span><span style="color:#111">replace</span> <span style="color:#111">rownames</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;_&#34;</span><span style="color:#f92672">+</span><span style="color:#111">rownames</span>
</span></span><span style="display:flex;"><span><span style="color:#111">reshape</span> <span style="color:#111">wide</span> <span style="color:#111">varpart</span> <span style="color:#111">theta</span> <span style="color:#111">var_epsilon</span> <span style="color:#111">fullvar</span> <span style="color:#111">varpct</span><span style="color:#111">,</span> <span style="color:#111">i</span><span style="color:#111">(</span><span style="color:#111">cusip</span> <span style="color:#111">year</span><span style="color:#111">)</span> <span style="color:#111">j</span><span style="color:#111">(</span><span style="color:#111">rownames</span><span style="color:#111">)</span> <span style="color:#111">string</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rename</span> <span style="color:#111">varpct_rm</span> <span style="color:#111">mktinfo</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rename</span> <span style="color:#111">varpct_x</span> <span style="color:#111">privteinfo</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rename</span> <span style="color:#111">varpct_r</span> <span style="color:#111">publicinfo</span>
</span></span><span style="display:flex;"><span><span style="color:#111">rename</span> <span style="color:#111">varpct_s</span> <span style="color:#111">noise</span>
</span></span><span style="display:flex;"><span><span style="color:#111">keep</span> <span style="color:#111">cusip</span> <span style="color:#111">year</span> <span style="color:#f92672">*</span><span style="color:#111">info</span> <span style="color:#111">noise</span>
</span></span><span style="display:flex;"><span><span style="color:#111">save</span> <span style="color:#111">panelbrogaard</span><span style="color:#111">,</span> <span style="color:#111">replace</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The final outcome is as follows.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-24">24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-25">25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-26">26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-27">27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-28">28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-21-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-21-29">29</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>. list in 1/20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     +-------------------------------------------------------------+
</span></span><span style="display:flex;"><span>     |    cusip   year   public~o    mktinfo      noise   privte~o |
</span></span><span style="display:flex;"><span>     |-------------------------------------------------------------|
</span></span><span style="display:flex;"><span>  1. | 00030710   2014   .4612017   17.60379   58.85497   23.08004 |
</span></span><span style="display:flex;"><span>  2. | 00030710   2015   43.65164   10.60914   12.57214   33.16709 |
</span></span><span style="display:flex;"><span>  3. | 00030710   2016   41.93059   13.32436   6.182855    38.5622 |
</span></span><span style="display:flex;"><span>  4. | 00030710   2017   54.59381   1.191425   14.96389   29.25087 |
</span></span><span style="display:flex;"><span>  5. | 00030710   2018     43.838   25.09339   8.907529   22.16108 |
</span></span><span style="display:flex;"><span>     |-------------------------------------------------------------|
</span></span><span style="display:flex;"><span>  6. | 00030710   2019   30.02275   25.98764   12.31215   31.67746 |
</span></span><span style="display:flex;"><span>  7. | 00032Q10   2018   18.90079   23.99627   36.99344   20.10949 |
</span></span><span style="display:flex;"><span>  8. | 00032Q10   2019   59.49644   5.478648   11.91035   23.11457 |
</span></span><span style="display:flex;"><span>  9. | 00032Q10   2020   55.21476    17.3996   19.76192   7.623722 |
</span></span><span style="display:flex;"><span> 10. | 00032Q10   2021   51.75403   25.38084   12.44535   10.41978 |
</span></span><span style="display:flex;"><span>     |-------------------------------------------------------------|
</span></span><span style="display:flex;"><span> 11. | 00036020   2005   40.70956   7.924543   26.06547   25.30043 |
</span></span><span style="display:flex;"><span> 12. | 00036020   2006   38.53111   21.68062   6.496971   33.29131 |
</span></span><span style="display:flex;"><span> 13. | 00036020   2007   32.78075   4.495751   27.55989    35.1636 |
</span></span><span style="display:flex;"><span> 14. | 00036020   2008   21.36486   47.52046   16.44107    14.6736 |
</span></span><span style="display:flex;"><span> 15. | 00036020   2009   34.37528   31.25706   17.96114   16.40653 |
</span></span><span style="display:flex;"><span>     |-------------------------------------------------------------|
</span></span><span style="display:flex;"><span> 16. | 00036020   2010   39.55574   34.02036   8.709065   17.71484 |
</span></span><span style="display:flex;"><span> 17. | 00036020   2011   21.50586   17.19429   46.27998   15.01987 |
</span></span><span style="display:flex;"><span> 18. | 00036020   2012    52.9045   11.12552   11.89774   24.07223 |
</span></span><span style="display:flex;"><span> 19. | 00036020   2013   12.02968   14.62235   16.48395   56.86403 |
</span></span><span style="display:flex;"><span> 20. | 00036020   2014   31.94392   42.19098   8.426245   17.43885 |
</span></span><span style="display:flex;"><span>     +-------------------------------------------------------------
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="conclusion">Conclusion</h2>
<p>In this blog, I replicated the stock volatility decomposition method introduced by Brogaard et al. (2022, RFS). Given the potential of this information-based decomposition method as I&rsquo;ve discussed in <a href="https://mengjiexu.com/post/an-information-based-decomposition-of-stock-price/">Theory for the information-based decomposition of stock price</a>, I hope this blog can help the readers make use of this method to empower their own research.</p>


                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/manually-replicate-statas-practice-in-estimations-of-var-irfs-and-variance-decomposition/" data-toggle="tooltip" data-placement="top" title="Dig into Estimation of VAR Coefficients, IRFs, and Variance Decomposition in Stata">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/deal-reedit/" data-toggle="tooltip" data-placement="top" title="Gain Insights From Organized Retail Investors in Reddit Wallstreetbets">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                


            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:m.xu@fs.de">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    <li>
                        <a href="https://twitter.com/xumj2021">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    

		            
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/xumj2021">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/mengjie-xu-37410712b/">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="Democratize Data For Insights" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Mengjie Xu 2024
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
